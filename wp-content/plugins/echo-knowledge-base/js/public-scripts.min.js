jQuery(document).ready(function(e){function t(t){e(".epkb-panel-container .epkb-tab-panel:nth-child("+(t+1)+")").addClass("active")}function a(e,t){var a=window.location.href;a=function(e,t,a){var i=new RegExp("([?&])"+t+"=.*?(&|$)","i"),n=-1!==e.indexOf("?")?"&":"?";return e.match(i)?e.replace(i,"$1"+t+"="+a+"$2"):e+n+t+"="+a}(a,"top-category",t),window.history.pushState({tab:e},"title",a)}var i=e("#epkb-main-page-container"),n=e("#epkb-content-container"),s=e(".epkb-nav-tabs li"),l=e(".epkb-tab-panel"),c=e("#eckb-article-content-body"),o=e(".eckb-article-toc");e("body").on("submit","#epkb_search_form",function(t){if(t.preventDefault(),""!==e("#epkb_search_terms").val()){var a={action:"epkb-search-kb",epkb_kb_id:e("#epkb_kb_id").val(),search_words:e("#epkb_search_terms").val()},i="";e.ajax({type:"GET",dataType:"json",data:a,url:ajaxurl,beforeSend:function(t){e(".loading-spinner").css("display","block"),e("#epkb-ajax-in-progress").show()}}).done(function(t){t=t||"",e(".loading-spinner").css("display","none"),i=t.error||"success"!==t.status?epkb_vars.msg_try_again:t.search_result}).fail(function(e,t,a){i=epkb_vars.msg_try_again+". ["+(a||epkb_vars.unknown_error)+"]"}).always(function(){e("#epkb-ajax-in-progress").hide(),i&&(e("#epkb_search_results").css("display","block"),e("#epkb_search_results").html(i))})}}),e("#epkb_search_terms").keyup(function(){this.value||e("#epkb_search_results").css("display","none")}),e(window).on("load",function(){var t=0;n.find(s).each(function(){var a=e(this).outerHeight(!0);a>t&&(t=a)}),n.find(s).css("min-height",t)}),window.onpopstate=function(t){t.state&&-1!==t.state.tab.indexOf("epkb_tab_")?(n.find(".epkb_top_panel").removeClass("active"),e("#main-category-selection").length>0?e("#main-category-selection").val(n.find("#"+t.state.tab).val()):(n.find(".epkb_top_categories").removeClass("active"),n.find("#"+t.state.tab).addClass("active")),n.find("."+t.state.tab).addClass("active")):e("#epkb_tab_1").length>0&&!n.find("#epkb_tab_1").hasClass("active")&&(n.find(".epkb_top_panel").removeClass("active"),e("#main-category-selection").length>0?e("#main-category-selection").val(n.find("#epkb_tab_1").val()):(n.find(".epkb_top_categories").removeClass("active"),n.find("#epkb_tab_1").addClass("active")),n.find(".epkb_tab_1").addClass("active"))},n.find(s).each(function(){e(this).on("click",function(){n.find(s).removeClass("active"),e(this).addClass("active"),n.find(l).removeClass("active"),t(e(this).index()),a(e(this).attr("id"),e(this).data("cat-name"))})}),e("#main-category-selection").change(function(){n.find(l).removeClass("active"),e("#main-category-selection option:selected").each(function(){t(e(this).index()),a(e(this).attr("id"),e(this).data("cat-name"))})}),e(".epkb-section-body .epkb-category-level-2-3").each(function(){e(this).on("click",function(){e(this).parent().children("ul").toggleClass("active")})}),n.find(".epkb-section-body .epkb-category-level-2-3").each(function(){var t=e(this).find("i");e(this).on("click",function(){function e(e){t.hasClass(e[0])?(t.removeClass(e[0]),t.addClass(e[1])):t.hasClass(e[1])&&(t.removeClass(e[1]),t.addClass(e[0]))}e(["ep_font_icon_plus","ep_font_icon_minus"]),e(["ep_font_icon_plus_box","ep_font_icon_minus_box"]),e(["ep_font_icon_right_arrow","ep_font_icon_down_arrow"]),e(["ep_font_icon_arrow_carrot_right","ep_font_icon_arrow_carrot_down"]),e(["ep_font_icon_arrow_carrot_right_circle","ep_font_icon_arrow_carrot_down_circle"]),e(["ep_font_icon_folder_add","ep_font_icon_folder_open"])})}),i.find(".epkb-show-all-articles").on("click",function(){e(this).toggleClass("active");var t=e(this).parent("ul").find("li");e(this).hasClass("active")?(e(this).find(".epkb-show-text").addClass("epkb-hide-elem"),e(this).find(".epkb-hide-text").removeClass("epkb-hide-elem")):(e(this).find(".epkb-show-text").removeClass("epkb-hide-elem"),e(this).find(".epkb-hide-text").addClass("epkb-hide-elem")),e(t).each(function(){e(this).hasClass("epkb-hide-elem")?(e(this).removeClass("epkb-hide-elem"),e(this).addClass("visible")):e(this).hasClass("visible")&&(e(this).removeClass("visible"),e(this).addClass("epkb-hide-elem"))})});let r=e("#epkb-search-kb").text();if(e("#epkb-search-kb").text(r),o.length){o.data("min")||o.data("min",1),o.data("offset")||o.data("offset",50);let t=o.data("min"),a="h"+t,i={scrollOffset:o.data("offset")},n=!1;for(void 0!==o.data("exclude_class")&&(n=o.data("exclude_class"));t<6;)a+=", h"+ ++t;let s=function(){let t=[];if(c.find(a).each(function(){if(0==e(this).text().length)return;if(n&&e(this).hasClass(o.data("exclude_class")))return;let a,i={};e(this).prop("id")?a=e(this).prop("id"):(a="articleTOC_"+t.length,e(this).prop("id",a)),i.id=a,i.title=e(this).text(),"H1"==e(this).prop("tagName")?i.level=1:"H2"==e(this).prop("tagName")?i.level=2:"H3"==e(this).prop("tagName")?i.level=3:"H4"==e(this).prop("tagName")?i.level=4:"H5"==e(this).prop("tagName")?i.level=5:"H6"==e(this).prop("tagName")&&(i.level=6),t.push(i)}),0==t.length)return t;let i=1,s=6;t.forEach(function(e){e.level>i&&(i=e.level),e.level<s&&(s=e.level)}),s>1&&t.forEach(function(e,a){t[a].level=e.level-s+1});let l=1;for(;l<i;){let e=!1;t.forEach(function(t){t.level==l&&(e=!0)}),e?l++:t.forEach(function(e,a){e.level>l&&(t[a].level=e.level-1)}),l++}return t}();s.length>0?(o.html(function(e){let t;if(o.find(".eckb-article-toc__title").length){let e=o.find(".eckb-article-toc__title").html();t=`\n\t\t\t\t\t<div class="eckb-article-toc__inner">\n\t\t\t\t\t\t<div class="eckb-article-toc__title">${e}</div>\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t`}else t='\n\t\t\t\t\t<div class="eckb-article-toc__inner">\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t';return e.forEach(function(e){t+=`<li class="eckb-article-toc__level eckb-article-toc__level-${e.level}"><a href="#${e.id}">${e.title}</a></li>`}),t+="\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t"}(s)),c.find(a).scrollSpy(i),e(" .eckb-article-toc--position-middle ").length>0?o.css("display","inline-block"):o.fadeIn()):o.hide();let l=e("#eckb-article-content-body").position();e(".eckb-article-page--L-sidebar-to-content").length>0&&e("#eckb-article-page-container-v2").find("#eckb-article-left-sidebar ").css("margin-top",l.top+"px"),e(".eckb-article-page--R-sidebar-to-content").length>0&&e("#eckb-article-page-container-v2").find("#eckb-article-right-sidebar ").css("margin-top",l.top+"px")}});