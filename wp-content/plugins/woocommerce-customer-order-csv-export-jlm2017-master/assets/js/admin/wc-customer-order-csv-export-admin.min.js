(function(){jQuery(document).ready(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o;return l={},d=wc_customer_order_csv_export_admin.is_wc_version_lt_2_6?a.WCBackboneModal.View.extend({events:{"click .modal-close":"closeButton","click #btn-ok":"addButton","touchstart #btn-ok":"addButton",keydown:"keyboardActions"},resizeContent:function(){var b,c;return b=a(".wc-backbone-modal-content").find("article"),c=.75*a(window).height(),b.css({"max-height":c+"px"})},initialize:function(b){var c;return c=this,this._target=b.target,this._string=b.string,_.bindAll(this,"render"),this.render(),a(".wc-backbone-modal-content").css({transform:"translate(-50%, -50%)"}),a(window).resize(function(){return c.resizeContent()})},render:function(){var b;return b=wp.template(this._target),this.$el.attr("tabindex","0").append(b(this._string)),a(document.body).css("overflow","hidden").append(this.$el),this.resizeContent(),a(document.body).trigger("wc_backbone_modal_loaded",this._target)}}):a.WCBackboneModal.View,o=function(a,b,c,d,e,f){var g,h,i;return i=a.length,e=e||25,f=f||i,h=0,g=function(){var j,k;for(k=+new Date,j=h;h<i&&h-j<f&&new Date-k<50;)b.call(c,a[h]),h+=1;return h<i?setTimeout(g,e):d(a)},setTimeout(g,25)},m=function(b){var c,d;return d={},c=function(b,c){var e;c.name=c.name.replace("[]",""),e=d[c.name],"undefined"!=typeof e&&null!==e?a.isArray(e)?e.push(c.value):d[c.name]=[e,c.value]:d[c.name]=c.value},a.each(a(b).serializeArray(),c),d},n=function(b){return a("#wc-backbone-modal-dialog .modal-close").trigger("click"),b.button_class=b.button_class||"",new d({target:"wc-customer-order-csv-export-modal",string:b})},h=function(b,c,d){var e,f;return e={action:"wc_customer_order_csv_export_create_export",security:wc_customer_order_csv_export_admin.create_export_nonce,export_type:c||"orders",export_query:b,export_method:d||"download"},f=wp.template("wc-customer-order-csv-export-modal-body-export-started"),n({title:wc_customer_order_csv_export_admin.i18n.export_started,body:f({export_method:d}),action:wc_customer_order_csv_export_admin.i18n.close}),a.post(ajaxurl,e).done(function(b){var c;if(a("#wc-backbone-modal-dialog").length)return!1===b.success?n({title:b.data.title,body:'<p><span class="dashicons dashicons-warning"></span> '+b.data.message+"</p>",action:wc_customer_order_csv_export_admin.i18n.close}):(a("#wc-backbone-modal-dialog").addClass("wc-customer-order-csv-export-"+b.export_id).data("wc-customer-order-csv-export-id",b.export_id),c=!1,l[b.export_id]=setInterval(function(){if(!c)return c=!0,a.get(b.status_url).done(function(a){return"string"==typeof a?n({title:wc_customer_order_csv_export_admin.i18n.unexpected_error,body:'<p><span class="dashicons dashicons-warning"></span> '+wc_customer_order_csv_export_admin.i18n.unexpected_error_message+"</p>",action:wc_customer_order_csv_export_admin.i18n.close}):(c=!1,!1===a.success&&(n({title:a.data.title,body:'<p><span class="dashicons dashicons-warning"></span> '+a.data.message+"</p>",action:wc_customer_order_csv_export_admin.i18n.close}),g(b.export_id)),"completed"!==a.status||"download"!==d&&"local"!==a.method&&"completed"!==a.transfer_status?void 0:(f=wp.template("wc-customer-order-csv-export-modal-body-export-completed"),n({title:wc_customer_order_csv_export_admin.i18n.export_completed,body:f({export_method:d,download_url:a.download_url}),action:wc_customer_order_csv_export_admin.i18n.done}),"download"===d&&(window.location.href=a.download_url),g(b.export_id)))}).fail(function(a,b,c){return n({title:wc_customer_order_csv_export_admin.i18n.unexpected_error,body:'<p><span class="dashicons dashicons-warning"></span> '+wc_customer_order_csv_export_admin.i18n.unexpected_error_message+"</p>",action:wc_customer_order_csv_export_admin.i18n.close})})},2e3))}).fail(function(a,b,c){return n({title:wc_customer_order_csv_export_admin.i18n.unexpected_error,body:'<p><span class="dashicons dashicons-warning"></span> '+wc_customer_order_csv_export_admin.i18n.unexpected_error_message+"</p>",action:wc_customer_order_csv_export_admin.i18n.close})})},g=function(b){return a.get(ajaxurl,{action:"wc_plugin_framework_customer_order_csv_export_dismiss_notice",messageid:"wc_customer_order_csv_export_finished_"+b})},wc_customer_order_csv_export_admin.settings_page===pagenow&&("export"===wc_customer_order_csv_export_admin.current_tab&&(i={dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:wc_customer_order_csv_export_admin.calendar_icon_url,buttonImageOnly:!0},a("#start_date").datepicker(i),a("#end_date").datepicker(i),a("input[name=type]").change(function(){var b;return b=a(".show_if_orders").closest("tr").add(a("#subscription_orders").closest("table.form-table")).add(a("#subscription_orders").closest("table.form-table").prev("h2")),"customers"===a(this).val()?b.hide():b.show()}),a("#mainform").submit(function(a){var b,c;return a.preventDefault(),c=m(this),b=c.type,delete c.type,h(c,b,"download")})),"export_list"===wc_customer_order_csv_export_admin.current_tab&&(a(".file_actions").find(".delete").on("click",function(a){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_delete))return a.preventDefault()}),a(".file_actions").find(".cancel").on("click",function(a){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_cancel))return a.preventDefault()}),a(".file_actions").find(".transfer, .email").on("click",function(a){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_transfer))return a.preventDefault()})),"settings"===wc_customer_order_csv_export_admin.current_tab&&(c={ftp:a(".js-auto-export-ftp-field:first").closest("table"),http_post:a(".js-auto-export-http-post-field:first").closest("table"),email:a(".js-auto-export-email-field:first").closest("table")},a(".js-auto-export-trigger").change(function(){var b,c;return c=a(this).val(),b=a(".js-auto-export-schedule-field").closest("tr"),"immediate"===c?b.hide():b.show()}).change(),a(".js-auto-export-method").change(function(){var b,d;return d=a(this).val(),b=a(this).closest("tr").nextUntil("h3"),"disabled"===d?b.hide():(b.show(),a(".js-auto-export-trigger").change()),"local"===d?a(this).next("span.description").show():a(this).next("span.description").hide(),a.each(c,function(a,b){var c;return c=a===d?"show":"hide",b[c]().prev()[c]()})}).change(),a(".js-auto-export-timepicker").timepicker({step:5}),a("select.js-auto-export-ftp-security").change(function(){var b,c,d;if(b=a(".js-auto-export-ftp-port"),c=Number(b.val(),10),d=a(this).val(),""===c||[21,22,990].indexOf(c)>-1)return"sftp"===d?b.val(22):"ftp_ssl"===d?b.val(990):b.val(21)}).change(),a(".js-auto-export-test-button").on("click",function(){return a("<input>").attr({type:"hidden",id:"wc_customer_order_csv_export_test_method",name:"wc_customer_order_csv_export_test_method",value:a(this).data("method")}).appendTo(".woocommerce form")})),"custom_formats"===wc_customer_order_csv_export_admin.current_tab&&(a(document.body).on("click.wp-toggle-checkboxes","thead .sv-check-column :checkbox, tfoot .sv-check-column :checkbox",function(b){var c,d,e;c=a(this).closest("table"),d=a(this).prop("checked"),e=b.shiftKey||a(this).data("wp-toggle"),c.children("tbody").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!a(this).is(":hidden,:disabled")&&(e?!a(this).prop("checked"):!!d)}),c.children("thead, tfoot").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!e&&!!d})}),a(".js-row-type").change(function(){var b,c,d,e;return e=a(".js-show-if-single-order-format").closest("tr"),b=a("select.js-field-key"),d=b.find('option[value="line_items"]'),c=b.find('option[value^="item_"]'),"order"===a(this).val()?(e.show(),d.prop("disabled",!1),c.prop("disabled",!0)):(e.hide(),d.prop("disabled",!0),c.prop("disabled",!1)),b.not('[name*="[__INDEX__]"]').removeClass("enhanced").select2("destroy"),a(document.body).trigger("wc-enhanced-select-init")}).change(),b=a(".wc-customer-order-csv-export-field-mapping"),e=function(c,d){var e,f,g;if(null==c&&(c={}),null==d&&(d=!1),f=b.find(".field-mapping-__INDEX__"),g=b.find("tbody tr").length-2,e=a(f.prop("outerHTML").replace(/__INDEX__/g,g)),e.find(".enhanced").removeClass("enhanced"),c.key&&(e.find(".js-field-key").val(c.key),"meta"===c.key&&(e.find(".js-field-meta-key-label").show(),c.meta_key&&e.find(".js-field-meta-key").val(c.meta_key))),c.name&&e.find(".js-field-name").val(c.name),f.before(e),b.find(".no-field-mappings").addClass("hide"),b.find("tfoot .js-remove-field-mapping").removeClass("hide"),d)return a(document.body).trigger("wc-enhanced-select-init")},k=function(c,d,e){var f;return null==d&&(d=400),null==e&&(e=null),e=e||function(){},f=function(){return b.find("tbody tr:visible").length<1&&(b.find(".no-field-mappings").removeClass("hide"),b.find(".js-remove-field-mapping").addClass("hide")),b.find('th.check-column input[type="checkbox"]').removeAttr("checked")},d?a.when(a(c).closest("tr.field-mapping").fadeOut(d,function(){var b;return b=a(this),setTimeout(function(){return b.remove()},1)})).then(function(){return f(),setTimeout(e,1)}):(a(c).closest("tr.field-mapping").remove(),f(),e())},j=function(){var c;return c=0,b.find("tr.field-mapping").each(function(b,d){if(!a(d).hasClass("field-mapping-__INDEX__"))return a(d).removeClass(function(a,b){var c,d;if(d=new RegExp("field-mapping-([0-9])*","g"),c=b.match(d))return c[0]}),a(d).addClass("field-mapping-"+c),a("input, select, textarea",d).each(function(a,b){var d;if(d=jQuery(b),d.attr("name"))return d.attr("name",d.attr("name").replace(/\[([^[]*)\]/,"["+c+"]"))}),c++})},f=function(c){return a(".wc-customer-order-csv-export-field-mapping").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),setTimeout(function(){var d;return c="string"==typeof c?JSON.parse(c):c,a(".js-include-all-meta").prop("checked",!0===c.include_all_meta),c.delimiter&&a(".js-delimiter").select2("val",c.delimiter,!0),c.row_type&&a(".js-row-type").length&&a(".js-row-type").select2("val",c.row_type,!0),c.items_format&&a(".js-items-format").length&&a(".js-items-format").select2("val",c.items_format,!0),k(b.find("tbody tr.field-mapping:not(.field-mapping-__INDEX__)"),!1),d=a.map(c.columns,function(a,b){return"string"==typeof a&&(a={name:a}),a.key||(a.key=b),a}),o(d,e,this,function(){return j(),a(document.body).trigger("wc-enhanced-select-init"),a(".wc-customer-order-csv-export-field-mapping").unblock()})},1)},b.find(".js-add-field-mapping").click(function(a){return a.preventDefault(),e(null,!0)}),b.find(".js-remove-field-mapping").click(function(a){var c;return a.preventDefault(),c=b.find('tbody input[type="checkbox"]:checked'),k(c,null,j)}),b.find(".js-load-mapping").click(function(b){return b.preventDefault(),n({title:wc_customer_order_csv_export_admin.i18n.load_mapping,body:a("#tmpl-wc-customer-order-csv-export-modal-body-load-mapping").html(),action:wc_customer_order_csv_export_admin.i18n.load,button_class:"button-primary"})}),a(document.body).on("change","#load-mapping-source",function(b){var c;return c=a(b.target).val(),"snippet"===c?a("#load-mapping-snippet").show():a("#load-mapping-snippet").hide()}),a(document.body).on("wc_backbone_modal_response",function(a,b,c){var d;return d="snippet"===c.source?c.snippet?JSON.parse(c.snippet):{columns:{}}:wc_customer_order_csv_export_admin.export_formats[c.source],setTimeout(function(){return f(d)},1)}),b.find("tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,update:j}),b.on("change","select.js-field-key",function(b){var c,d,e;if(c=a(b.target),d=c.closest("tr").find(".js-field-name"),"meta"===c.val()?c.closest("td").find(".js-field-meta-key-label").removeClass("hide").find("input").focus():c.closest("td").find(".js-field-meta-key-label").addClass("hide").find("input").val(""),!d.val()||b.removed&&b.removed.id===d.val())return e="meta"===c.val()?"":c.val(),d.val(e)}),a("#mainform").submit(function(b){return a("tr.field-mapping-__INDEX__").remove()}))),"edit-shop_order"===pagenow&&(a('#posts-filter input[type="submit"].action').on("click",function(b){var c,d,e;if(c=a(b.target).prev("select").val(),"download_to_csv"===c||"export_to_csv_via_auto_export_method"===c)return b.preventDefault(),e="download_to_csv"===c?"download":"auto_export",d=a.map(a("#posts-filter").find('input[name="post[]"]:checked'),function(b){return Number(a(b).val(),10)}),h({ids:d},"orders",e)}),a(".order_actions .download_to_csv").on("click",function(b){var c;return b.preventDefault(),c=a(this).closest("tr").find('th input[name="post[]"]').val(),h({ids:c},"orders","download")})),"shop_order"===pagenow&&a("form#post").submit(function(b){var c,d,e;if(c=a(this).find('select[name="wc_order_action"]').val(),c&&["wc_customer_order_csv_export_download","wc_customer_order_csv_export_via_auto_export_method"].indexOf(c)!==-1)return b.preventDefault(),e="wc_customer_order_csv_export_download"===c?"download":"auto_export",d=[woocommerce_admin_meta_boxes.post_id],h({ids:d},"orders",e)}),a("body").on("wc_backbone_modal_before_remove",function(b){var c;if(c=a("#wc-backbone-modal-dialog").data("wc-customer-order-csv-export-id"),c&&l[c])return clearInterval(l[c])})})}).call(this);